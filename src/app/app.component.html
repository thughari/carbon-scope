<div
  class="h-screen w-screen bg-[#020617] text-slate-50 flex flex-col xl:flex-row overflow-hidden relative selection:bg-indigo-500/30">

  <div
    class="fixed top-0 left-0 w-full h-[500px] bg-indigo-900/10 blur-[120px] pointer-events-none rounded-full -translate-y-1/2">
  </div>
  <div
    class="fixed bottom-0 right-0 w-[500px] h-[500px] bg-sky-900/10 blur-[120px] pointer-events-none rounded-full translate-y-1/3">
  </div>

  <div class="flex-1 flex flex-col h-full overflow-hidden relative z-10">

    <header class="px-6 md:px-10 py-5 flex items-center justify-between shrink-0">
      <div>
        <h1 class="text-2xl font-bold tracking-tight flex items-center gap-3">
          <div class="h-10 w-10 flex items-center justify-center">
            <img src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Carbon_footprint_icon.png"
              alt="Carbon Footprint" class="h-full w-full object-contain brightness-0 invert opacity-90">
          </div>
          <span class="text-white">Carbon<span class="text-slate-400">Scope</span></span>
        </h1>
      </div>
      <div class="hidden md:block text-right">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border transition-colors duration-500"
          [ngClass]="isSystemOnline 
            ? 'bg-emerald-500/10 border-emerald-500/20' 
            : 'bg-rose-500/10 border-rose-500/20'">
          <span class="relative flex h-2 w-2">
            <span *ngIf="isSystemOnline"
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2"
              [ngClass]="isSystemOnline ? 'bg-emerald-500' : 'bg-rose-500'">
            </span>
          </span>
          <span class="text-[11px] font-semibold uppercase tracking-wider"
            [ngClass]="isSystemOnline ? 'text-emerald-400' : 'text-rose-400'">
            {{ isSystemOnline ? 'Live System' : 'System Offline' }}
          </span>
        </div>
      </div>
    </header>

    <main class="flex-1 overflow-y-auto overflow-x-hidden px-4 md:px-10 pb-4 space-y-6 scroll-smooth flex flex-col">

      <div class="flex flex-col lg:flex-row gap-6 animate-fade-in shrink-0">
        <div class="flex-1">
          <app-header-stats [totalEmissions]="headerTotal / 1_000_000" [globalTotal]="globalEmissionsTotal / 1_000_000"
            [highestSector]="headerHighestSector" [yearRange]="headerYearRange" [selectedGas]="filters.gas">
          </app-header-stats>
        </div>
        <div class="lg:w-[450px]">
          <app-filters-bar [continents]="continents" [countries]="countries" [sectors]="sectors" [filters]="filters"
            (filtersChange)="onFiltersChange($event)">
          </app-filters-bar>
        </div>
      </div>

      <div class="animate-fade-in shrink-0" style="animation-delay: 100ms">
        <app-sector-charts [sectorTotals]="sectorTotals" [trendSeries]="trendSeries" [trendYears]="trendYears"
          [selectedSector]="selectedSector">
        </app-sector-charts>
      </div>

      <div class="animate-fade-in shrink-0" style="animation-delay: 200ms">
        <app-sector-table [sectorTotals]="sectorTotals" [subsectorData]="subsectorSummary"
          [isLoadingSubsectors]="loadingSubsectors" (sectorClick)="onSectorClick($event)">
        </app-sector-table>
      </div>

      <div class="flex-1"></div>
      <!-- me @thughari -->
      <div class="py-4 text-center border-t border-white/5 animate-fade-in" style="animation-delay: 300ms">
        <p class="text-xs text-slate-500 font-medium tracking-wide">
          Developed by
          <a href="https://thughari.github.io/" target="_blank" rel="noopener noreferrer"
            class="text-indigo-400 hover:text-indigo-300 transition-colors font-semibold hover:underline">
            Hari
          </a>
        </p>
      </div>

      <div class="h-20 xl:hidden shrink-0"></div>
    </main>
  </div>

  <div class="hidden xl:flex relative z-20 shadow-2xl" [style.width.px]="sidebarWidth">
    <div class="w-1.5 h-full cursor-col-resize hover:bg-indigo-500/50 transition-colors absolute left-0 top-0 z-30"
      (mousedown)="startResizing($event)">
    </div>
    <div class="flex-1 h-full bg-[#0B1121] border-l border-white/5 relative overflow-hidden">
      <app-chat-panel class="h-full w-full block" [currentCountry]="filters.country"
        [currentContinent]="filters.continent" [currentYear]="headerYearRange[1]">
      </app-chat-panel>
    </div>
  </div>

  <button *ngIf="!isMobileChatOpen" (click)="toggleMobileChat()"
    class="xl:hidden fixed bottom-6 right-6 z-50 h-14 w-14 rounded-full bg-indigo-600 shadow-lg shadow-indigo-500/40 flex items-center justify-center text-white active:scale-90 transition-transform">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  </button>

  <div *ngIf="isMobileChatOpen"
    class="xl:hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-md animate-fade-in flex items-center justify-center p-4"
    (click)="toggleMobileChat()">
    <div
      class="w-full max-w-md h-[85vh] bg-[#0B1121] border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex flex-col relative animate-slide-up"
      (click)="$event.stopPropagation()">
      <button (click)="toggleMobileChat()"
        class="absolute top-3 right-3 z-50 h-8 w-8 rounded-full bg-slate-800/80 border border-white/10 flex items-center justify-center text-slate-300 hover:bg-rose-500 hover:text-white hover:border-rose-500 transition-all shadow-lg backdrop-blur-sm">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <div class="flex-1 h-full min-h-0 overflow-hidden">
        <app-chat-panel class="h-full w-full block" [currentCountry]="filters.country"
          [currentContinent]="filters.continent" [currentYear]="headerYearRange[1]">
        </app-chat-panel>
      </div>
    </div>
  </div>
</div>